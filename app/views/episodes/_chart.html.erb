<% if JSON.parse(data).empty? %>
  <h2>Empty Data</h2>
<% else %>
  <canvas id="<%= title %>"></canvas>
  <script>
    var ctx = document.getElementById('<%= title %>').getContext('2d');
    var listByKey = (key) => data.map(obj => obj[key]);
    var data = <%= raw data %>;
    var keys = <%= raw keys %>;
    var labels = {
      x: "WorldPositionX",
      y: "WorldPositionY",
      z: "WorldPositionZ",
      r: "WorldRotationYaw",
      dx: "BodyVelocityX",
      dy: "BodyVelocityY",
      dz: "BodyVelocityZ",
      w: "BodyAngVelocityYaw",
      roll: "Roll",
      pitch: "Pitch",
      throttle: "Throttle",
      yaw: "Yaw",
      white: "#fff",
    }
    var colors = {
      x: "rgb(255, 127, 127)",
      y: "rgb(127, 255, 127)",
      z: "rgb(127, 127, 255)",
      r: "rgb(127, 127, 127)",
      dx: "rgb(255, 127, 127)",
      dy: "rgb(127, 255, 127)",
      dz: "rgb(127, 127, 255)",
      w: "rgb(127, 127, 127)",
      roll: "rgb(255, 127, 127)",
      pitch: "rgb(127, 255, 127)",
      throttle: "rgb(127, 127, 255)",
      yaw: "rgb(127, 127, 127)",
      white: "#fff",
    };
    var <%= title %>Chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: listByKey("t"),
        datasets: keys.map(key => ({
          label: labels[key],
          fill: false,
          borderColor: colors[key],
          pointBorderColor: colors[key],
          pointBackgroundColor: colors.white,
          pointHoverBackgroundColor: colors[key],
          pointHoverBorderColor: colors.white,
          data: listByKey(key).map(val => val * (key === "r" ? 0.1 : 1)),
        }))
      },
    });
  </script>
<% end %>
